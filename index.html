<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>í¸ë°±ë‚˜ë¬´ ì£¼ì°¨ ë°°ì • ì‹œìŠ¤í…œ</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --primary: #2c3e50; --accent: #2980b9; --joint: #ecf0f1; --danger: #c0392b; --success: #27ae60; }
        body { font-family: 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif; background-color: #f0f2f5; margin: 0; padding: 10px; color: #333; -webkit-font-smoothing: antialiased; }
        
        .container { max-width: 1000px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); overflow: hidden; }
        
        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        header { background: var(--primary); color: white; padding: 15px; text-align: center; }
        h1 { margin: 0; font-size: 1.2rem; cursor: pointer; }
        .sub-txt { font-size: 0.8rem; opacity: 0.8; margin-top: 5px; }
        .admin-badge { display: none; background: #e74c3c; color: white; font-size: 0.7rem; padding: 2px 8px; border-radius: 10px; margin-left: 5px; vertical-align: middle; }

        /* ì„¸ëŒ€ ëª…ë‹¨ ë¦¬ìŠ¤íŠ¸ */
        .dong-wrapper { display: none; padding: 15px; background: #fff; gap: 10px; flex-wrap: wrap; border-bottom: 5px solid #eee; }
        .dong-column { flex: 1; min-width: 140px; border: 1px solid #ddd; border-radius: 8px; padding: 10px; }
        .dong-title { font-weight: bold; text-align: center; padding-bottom: 5px; border-bottom: 2px solid var(--primary); margin-bottom: 8px; color: var(--primary); }
        .list-item { font-size: 13px; display: flex; justify-content: space-between; padding: 3px 0; border-bottom: 1px solid #f5f5f5; }
        .list-item label { cursor: pointer; display: flex; align-items: center; width: 100%; }
        .fixed-seat { color: var(--danger); font-weight: bold; font-size: 0.8em; margin-left: auto; }

        /* ë§µ ì„¹ì…˜ (í•µì‹¬: ê°€ë¡œ ìŠ¤í¬ë¡¤) */
        .map-wrapper { 
            overflow-x: auto; /* ê°€ë¡œ ìŠ¤í¬ë¡¤ í—ˆìš© */
            padding: 20px 10px; 
            background: #f8f9fa;
            border-top: 1px solid #eee;
            border-bottom: 1px solid #eee;
            -webkit-overflow-scrolling: touch; /* ëª¨ë°”ì¼ ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤ */
        }
        
        /* ì§€ë„ê°€ ì°Œê·¸ëŸ¬ì§€ì§€ ì•Šë„ë¡ ìµœì†Œ ë„ˆë¹„ ì„¤ì • */
        .map-container { 
            display: flex; 
            flex-direction: column; 
            gap: 15px; 
            align-items: center; 
            min-width: 600px; /* ëª¨ë°”ì¼ì—ì„œë„ ì´ ë„ˆë¹„ ìœ ì§€ */
            padding: 0 10px;
        }

        .building-row { display: flex; gap: 10px; width: 100%; justify-content: center; }
        
        .zone-box { 
            border: 2px solid var(--primary); 
            border-radius: 10px; 
            background: white; 
            padding: 30px 10px 10px; 
            position: relative; 
            display: flex;
            gap: 5px;
            justify-content: center;
        }
        .zone-label { 
            position: absolute; top: -10px; left: 10px; 
            background: var(--primary); color: white; 
            padding: 4px 12px; font-size: 12px; font-weight: bold; border-radius: 15px; 
        }
        
        .joint-zone { border: 2px dashed var(--accent); background: #fdfdfd; }
        .joint-zone .zone-label { background: var(--accent); }

        /* ì£¼ì°¨ ìŠ¬ë¡¯ ë””ìì¸ */
        .slot { 
            width: 70px; height: 90px; 
            border: 1px solid #bdc3c7; border-radius: 6px; 
            display: flex; flex-direction: column; 
            align-items: center; justify-content: center; 
            font-size: 13px; text-align: center; 
            position: relative; background: white;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.05);
        }
        .slot-toggle { position: absolute; top: 2px; left: 2px; transform: scale(0.8); z-index: 10; display: none; }
        
        /* ìŠ¬ë¡¯ ìƒíƒœ */
        .filled { background-color: #dbfadd !important; border: 2px solid #27ae60 !important; color: #1e8449; font-weight: bold; }
        .unassigned { background-color: #f2f2f2 !important; border: 2px dashed #999 !important; color: #999; }
        
        /* íŠ¹ìˆ˜ ìŠ¬ë¡¯ */
        .pillar { width: 30px; background: #95a5a6; border: none; color: transparent; box-shadow: none; }
        .pillar::after { content: ''; display: block; width: 10px; height: 10px; background: #7f8c8d; border-radius: 50%; }
        .entrance { width: 80px; background: #34495e; color: white; border: none; font-size: 11px; font-weight: bold; line-height: 1.2; }
        .disabled { background: #2980b9; color: white; border: none; font-weight: bold; }

        /* ê²°ê³¼ ë¦¬í¬íŠ¸ */
        #summaryArea { display: none; margin: 15px; padding: 15px; background: #fff; border-left: 5px solid var(--accent); border-radius: 4px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); text-align: left; line-height: 1.6; font-size: 14px; }
        
        /* ê´€ë¦¬ì íŒ¨ë„ */
        #adminControls { display: none; padding: 15px; background: #fff0f0; border-top: 1px solid #ffcccc; text-align: center; }
        .btn-group { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; margin-top: 10px; }
        .btn { padding: 10px 16px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; color: white; font-size: 14px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .btn-draw { background: var(--primary); }
        .btn-save { background: var(--success); }
        .btn-reset { background: var(--danger); }
        .btn-img { background: #7f8c8d; width: 100%; margin-top: 10px; }

    </style>
</head>
<body>

<div class="container">
    <header onclick="handleAdminLogin()">
        <h1>ğŸš™ í¸ë°±ë‚˜ë¬´ ì£¼ì°¨ ë°°ì •</h1>
        <div class="sub-txt">í„°ì¹˜í•˜ì—¬ ê´€ë¦¬ì ëª¨ë“œ ì§„ì… <span id="adminBadge" class="admin-badge">ADMIN</span></div>
    </header>

    <div id="unitWrapper" class="dong-wrapper">
        <div class="dong-column"><div class="dong-title">Aë™ (í•„ë¡œí‹°A)</div><div id="list-A"></div></div>
        <div class="dong-column"><div class="dong-title">Bë™ (í•„ë¡œí‹°B)</div><div id="list-B"></div></div>
        <div class="dong-column"><div class="dong-title">Cë™ (í•„ë¡œí‹°C)</div><div id="list-C"></div></div>
    </div>

    <div id="printArea">
        <div id="summaryArea"></div>
        <div class="map-wrapper">
            <div class="map-container">
                <div class="building-row">
                    <div class="zone-box" style="width: 100%;">
                        <div class="zone-label">Aë™ í•„ë¡œí‹° (Aë™ ì „ìš©)</div>
                        <div class="slot" data-role="parking" data-zone="A">A-1</div>
                        <div class="slot" data-role="parking" data-zone="A">A-2</div>
                        <div class="slot pillar"></div>
                        <div class="slot" data-role="parking" data-zone="A">A-3</div>
                        <div class="slot entrance">ì¶œì…êµ¬</div>
                        <div class="slot" data-role="parking" data-zone="A">A-4</div>
                        <div class="slot pillar"></div>
                        <div class="slot" data-role="parking" data-zone="A">A-5</div>
                        <div class="slot" data-role="parking" data-zone="A">A-6</div>
                        <div class="slot pillar"></div>
                        <div class="slot disabled">ì¥ì• ì¸</div>
                    </div>
                </div>

                <div class="building-row">
                    <div class="zone-box joint-zone" style="width: 60%;">
                        <div class="zone-label">A-B ê³µë™êµ¬ì—­ (íƒˆë½ì ë°°ì •)</div>
                        <div class="slot disabled">ì¥ì• ì¸</div>
                        <div class="slot" data-role="parking" data-zone="AB">AB-1</div>
                        <div class="slot" data-role="parking" data-zone="AB">AB-2</div>
                        <div class="slot" data-role="parking" data-zone="AB">AB-3</div>
                    </div>
                </div>

                <div class="building-row">
                    <div class="zone-box" style="width: 100%;">
                        <div class="zone-label">Bë™ í•„ë¡œí‹° (Bë™ ì „ìš©)</div>
                        <div class="slot" data-role="parking" data-zone="B">B-1</div>
                        <div class="slot" data-role="parking" data-zone="B">B-2</div>
                        <div class="slot entrance">ì¶œì…êµ¬</div>
                        <div class="slot" data-role="parking" data-zone="B">B-3</div>
                        <div class="slot" data-role="parking" data-zone="B">B-4</div>
                        <div class="slot pillar"></div>
                        <div class="slot" data-role="parking" data-zone="B">B-5</div>
                        <div class="slot pillar"></div>
                        <div class="slot" data-role="parking" data-zone="B">B-6</div>
                        <div class="slot" data-role="parking" data-zone="B">B-7</div>
                    </div>
                </div>

                <div class="building-row">
                    <div class="zone-box joint-zone" style="width: 60%;">
                        <div class="zone-label">B-C ê³µë™êµ¬ì—­ (íƒˆë½ì ë°°ì •)</div>
                        <div class="slot" data-role="parking" data-zone="BC">BC-1</div>
                        <div class="slot" data-role="parking" data-zone="BC">BC-2</div>
                        <div class="slot" data-role="parking" data-zone="BC">BC-3</div>
                        <div class="slot" data-role="parking" data-zone="BC">BC-4</div>
                    </div>
                </div>

                 <div class="building-row">
                    <div class="zone-box" style="width: 100%;">
                        <div class="zone-label">Cë™ í•„ë¡œí‹° (Cë™ ì „ìš©)</div>
                        <div class="slot" data-role="parking" data-zone="C">C-1</div>
                        <div class="slot" data-role="parking" data-zone="C">C-2</div>
                        <div class="slot entrance">ì¶œì…êµ¬</div>
                        <div class="slot" data-role="parking" data-zone="C">C-3</div>
                        <div class="slot" data-role="parking" data-zone="C">C-4</div>
                        <div class="slot disabled">Cì¥ì• ì¸<br>(403í˜¸)</div>
                        <div class="slot pillar"></div>
                        <div class="slot" data-role="parking" data-zone="C">C-5</div>
                        <div class="slot" data-role="parking" data-zone="C">C-6</div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div id="adminControls">
        <h3 style="margin:0 0 10px 0;">âš™ï¸ ê´€ë¦¬ì ì œì–´íŒ</h3>
        <div class="btn-group">
            <button class="btn btn-draw" onclick="runLottery()">ğŸ² ê·œì¹™ê¸°ë°˜ ì¶”ì²¨</button>
            <button class="btn btn-save" onclick="saveData()">ğŸ’¾ ì„œë²„ ì €ì¥</button>
            <button class="btn btn-reset" onclick="resetData()">ğŸ§¹ ì´ˆê¸°í™”</button>
        </div>
        <button class="btn btn-img" onclick="downloadImage()">ğŸ“¸ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ</button>
    </div>
</div>

<script>
    // 1. íŒŒì´ì–´ë² ì´ìŠ¤ ì„¤ì •
    const firebaseConfig = {
        apiKey: "AIzaSyC0jloY1-k3bzz4HuPrmpL0wdtzHYMw-FE",
        databaseURL: "https://parking-bd6fa-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "parking-bd6fa"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // 2. ì´ˆê¸° ë°ì´í„° ì„¸íŒ…
    // ì œì™¸ì„¸ëŒ€: ì…ì£¼ ì•ˆí–ˆê±°ë‚˜ ì°¨ëŸ‰ ì—†ëŠ” ì„¸ëŒ€
    const skipList = ['Aë™ 201í˜¸', 'Aë™ 202í˜¸', 'Aë™ 401í˜¸', 'Cë™ 202í˜¸', 'Cë™ 502í˜¸'];
    // ê³ ì •ì„: ì¶”ì²¨ì—ì„œ ì œì™¸í•˜ê³  ë³„ë„ í‘œê¸°
    const fixedList = { 'Cë™ 403í˜¸': 'Cë™ ì¥ì• ì¸êµ¬ì—­' }; 

    let isAdmin = false;
    let clickCount = 0;

    function init() {
        renderUnitList();
        addSlotToggles();
        loadServerData();
    }

    // ì„¸ëŒ€ ë¦¬ìŠ¤íŠ¸ ìƒì„± UI
    function renderUnitList() {
        ['A','B','C'].forEach(dong => {
            const container = document.getElementById(`list-${dong}`);
            container.innerHTML = "";
            for(let f=2; f<=5; f++){
                let rooms = (dong === 'B' && f > 3) || (dong === 'C' && f === 5) ? 2 : 3;
                for(let r=1; r<=rooms; r++){
                    const name = `${dong}ë™ ${f}0${r}í˜¸`;
                    let statusHtml = "";
                    let isDisabled = false;
                    let isChecked = true;

                    if(skipList.includes(name)) {
                        statusHtml = `<span style="color:#999; font-size:11px;">(ì œì™¸)</span>`;
                        isChecked = false;
                    }
                    if(fixedList[name]) {
                        statusHtml = `<span class="fixed-seat">ê³ ì •ì„</span>`;
                        isDisabled = true;
                        isChecked = false;
                    }

                    container.innerHTML += `
                        <div class="list-item">
                            <label>
                                <input type="checkbox" class="chk-unit" value="${name}" data-dong="${dong}" 
                                ${isChecked ? 'checked' : ''} ${isDisabled ? 'disabled' : ''} disabled>
                                &nbsp;${f}0${r}í˜¸ ${statusHtml}
                            </label>
                        </div>`;
                }
            }
        });
    }

    // ê´€ë¦¬ì ëª¨ë“œìš© ìŠ¬ë¡¯ í† ê¸€ ë²„íŠ¼ ì¶”ê°€
    function addSlotToggles() {
        document.querySelectorAll('.slot[data-role="parking"]').forEach(slot => {
            slot.innerHTML += `<input type="checkbox" class="slot-toggle" checked onchange="toggleSlot(this)">`;
        });
    }

    function toggleSlot(chk) {
        const slot = chk.closest('.slot');
        if(chk.checked) {
            slot.classList.remove('unassigned');
            slot.querySelector('input').nextSibling.nodeValue = slot.dataset.zone + "êµ¬ì—­"; // í…ìŠ¤íŠ¸ ë³µêµ¬ëŠ” ê°„ëµí™”
        } else {
            slot.classList.add('unassigned');
            slot.childNodes[0].nodeValue = "ë¹„ì§€ì •";
        }
    }

    // ==========================================
    // í•µì‹¬: ê·œì¹™ ê¸°ë°˜ ì¶”ì²¨ ì•Œê³ ë¦¬ì¦˜
    // ==========================================
    function runLottery() {
        if(!confirm("ê¸°ì¡´ ë°°ì •ì„ ì§€ìš°ê³  ìƒˆë¡œ ì¶”ì²¨í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

        // 1. ì‹ ì²­ì ëª…ë‹¨ í™•ë³´
        const applicants = Array.from(document.querySelectorAll('.chk-unit:checked')).map(el => ({
            name: el.value,
            dong: el.dataset.dong
        }));

        if(applicants.length === 0) return alert("ë°°ì •í•  ì„¸ëŒ€ê°€ ì—†ìŠµë‹ˆë‹¤.");

        // 2. êµ¬ì—­ë³„ ìŠ¬ë¡¯ í™•ë³´ (ë¹„ì§€ì •/ê³ ì • ì œì™¸)
        const getSlots = (zone) => Array.from(document.querySelectorAll(`.slot[data-zone="${zone}"]:not(.unassigned)`));
        const slotsA = getSlots('A');
        const slotsB = getSlots('B');
        const slotsC = getSlots('C');
        const slotsAB = getSlots('AB');
        const slotsBC = getSlots('BC');

        // ìŠ¬ë¡¯ ì´ˆê¸°í™”
        document.querySelectorAll('.slot[data-role="parking"]').forEach(s => {
            s.classList.remove('filled');
            // í…ìŠ¤íŠ¸ ë…¸ë“œë§Œ ë³€ê²½ (ì²´í¬ë°•ìŠ¤ ë³´ì¡´)
            let textNode = s.childNodes[0];
            if(textNode.nodeType === 3) textNode.nodeValue = ""; 
        });

        // 3. ê·¸ë£¹ ë¶„ë¦¬ ë° ì…”í”Œ
        const shuffle = (arr) => arr.sort(() => Math.random() - 0.5);
        
        let groupA = shuffle(applicants.filter(p => p.dong === 'A'));
        let groupB = shuffle(applicants.filter(p => p.dong === 'B'));
        let groupC = shuffle(applicants.filter(p => p.dong === 'C'));

        let assigned = [];
        let failed = [];

        // === 1ë‹¨ê³„: ê° ë™ í•„ë¡œí‹° ìš°ì„  ë°°ì • ===
        function assignPhase(people, slots) {
            let winners = people.slice(0, slots.length);
            let losers = people.slice(slots.length);
            winners.forEach((p, i) => {
                const s = slots[i];
                s.classList.add('filled');
                s.childNodes[0].nodeValue = p.name.replace("ë™ ", "\n");
                assigned.push(p.name);
            });
            return losers;
        }

        let remainA = assignPhase(groupA, slotsA);
        let remainB = assignPhase(groupB, slotsB);
        let remainC = assignPhase(groupC, slotsC);

        // === 2ë‹¨ê³„: ê³µë™êµ¬ì—­ ë°°ì • ===
        // ê·œì¹™ 4: A-B ì‚¬ì´ëŠ” ë‚¨ì€ Aì™€ B ì„¸ëŒ€ ë°°ì •
        let poolAB = shuffle([...remainA, ...remainB]); 
        let remainAB = assignPhase(poolAB, slotsAB); 
        // ì—¬ê¸°ì„œ ë–¨ì–´ì§„ ì‚¬ëŒì€? B-C ê³µë™êµ¬ì—­ìœ¼ë¡œ ê°ˆ ìˆ˜ ìˆë‚˜?
        // ê·œì¹™ 5: B-C ì‚¬ì´ëŠ” ë‚¨ì€ Bì™€ C ì„¸ëŒ€. 
        // (ABê³µë™ì—ì„œ ë–¨ì–´ì§„ Bì™€, ì›ë˜ ë‚¨ì€ Cë¥¼ í•©ì¹œë‹¤? í˜¹ì€ BëŠ” ê¸°íšŒê°€ ë‘ë²ˆì¸ê°€? 
        //  ë³´í†µì€ Aì”ì—¬+Bì”ì—¬ -> ABêµ¬ì—­, ê·¸ë¦¬ê³  ìˆœìˆ˜í•œ Cì”ì—¬ì™€ Bì˜ ë˜ë‹¤ë¥¸ ì”ì—¬ê°€ ê°€ëŠ”ë°
        //  ì—¬ê¸°ì„œëŠ” ë‹¨ìˆœí•˜ê²Œ ABì—ì„œ ë–¨ì–´ì§„ ì‚¬ëŒ ì¤‘ Bë™ ì‚¬ëŒ + Cë™ ì”ì—¬ë¡œ B-Cë¥¼ ì±„ìš°ê² ìŠµë‹ˆë‹¤.)
        
        let leftoverFromAB_B = remainAB.filter(p => p.dong === 'B'); // ABì—ì„œ ë–¨ì–´ì§„ B
        let leftoverFromAB_A = remainAB.filter(p => p.dong === 'A'); // ABì—ì„œ ë–¨ì–´ì§„ A (ì™„ì „ íƒˆë½)

        let poolBC = shuffle([...leftoverFromAB_B, ...remainC]); // Cì”ì—¬ + (ABì—ì„œ ë–¨ì–´ì§„ B)
        let finalFailures = assignPhase(poolBC, slotsBC);

        // ìµœì¢… íƒˆë½ì ëª…ë‹¨
        let totalFailures = [...leftoverFromAB_A, ...finalFailures];

        // ë¦¬í¬íŠ¸ ì‘ì„±
        let reportHtml = `
            <strong>ğŸ“Š ë°°ì • ê²°ê³¼ ìš”ì•½</strong><br>
            â€¢ ì´ ì‹ ì²­: ${applicants.length}ì„¸ëŒ€ / ë‹¹ì²¨: ${assigned.length}ì„¸ëŒ€<br>
            â€¢ Aë™ í•„ë¡œí‹°: ${groupA.length - remainA.length} ë°°ì •<br>
            â€¢ Bë™ í•„ë¡œí‹°: ${groupB.length - remainB.length} ë°°ì •<br>
            â€¢ Cë™ í•„ë¡œí‹°: ${groupC.length - remainC.length} ë°°ì •<br>
            â€¢ ê³µë™êµ¬ì—­ ì¶”ê°€ ë°°ì • ì™„ë£Œ<br>
        `;
        
        if(totalFailures.length > 0) {
            reportHtml += `<div style="color:red; margin-top:5px;">âš ï¸ ì£¼ì°¨ ë¶ˆê°€ ì„¸ëŒ€: ${totalFailures.map(p=>p.name).join(', ')}</div>`;
        } else {
            reportHtml += `<div style="color:green; margin-top:5px;">ğŸ‰ ì „ì› ë°°ì • ì™„ë£Œ!</div>`;
        }

        document.getElementById('summaryArea').innerHTML = reportHtml;
        document.getElementById('summaryArea').style.display = 'block';
    }

    // ==========================================
    // ì„œë²„ ì €ì¥ ë° ë¡œë“œ
    // ==========================================
    function saveData() {
        if(!isAdmin) return;
        const mapData = [];
        document.querySelectorAll('.slot[data-role="parking"]').forEach((s, idx) => {
            mapData.push({
                idx: idx,
                text: s.childNodes[0].nodeValue.trim(),
                isFilled: s.classList.contains('filled'),
                isUnassigned: s.classList.contains('unassigned')
            });
        });
        
        const report = document.getElementById('summaryArea').innerHTML;
        
        db.ref('parking_v2').set({
            map: mapData,
            report: report,
            updatedAt: new Date().toLocaleString()
        }).then(()=>alert("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤."));
    }

    function loadServerData() {
        db.ref('parking_v2').on('value', snapshot => {
            const data = snapshot.val();
            if(!data) return;

            const slots = document.querySelectorAll('.slot[data-role="parking"]');
            if(data.map) {
                data.map.forEach((d, i) => {
                    if(slots[i]) {
                        slots[i].childNodes[0].nodeValue = d.text;
                        if(d.isFilled) slots[i].classList.add('filled');
                        else slots[i].classList.remove('filled');
                        
                        if(d.isUnassigned) slots[i].classList.add('unassigned');
                        else slots[i].classList.remove('unassigned');
                    }
                });
            }
            if(data.report) {
                document.getElementById('summaryArea').innerHTML = data.report;
                document.getElementById('summaryArea').style.display = 'block';
            }
        });
    }

    function resetData() {
        if(confirm("ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            db.ref('parking_v2').remove();
            location.reload();
        }
    }

    // ê´€ë¦¬ì ë¡œê·¸ì¸ ë¡œì§ (ì œëª© 5íšŒ í„°ì¹˜)
    function handleAdminLogin() {
        clickCount++;
        if(clickCount >= 5) {
            const pwd = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”");
            if(pwd === "1234") { // ë¹„ë°€ë²ˆí˜¸
                isAdmin = true;
                document.getElementById('adminBadge').style.display = 'inline-block';
                document.getElementById('adminControls').style.display = 'block';
                document.getElementById('unitWrapper').style.display = 'flex';
                document.querySelectorAll('.chk-unit').forEach(el => el.disabled = false);
                document.querySelectorAll('.slot-toggle').forEach(el => el.style.display = 'block');
                alert("ê´€ë¦¬ì ëª¨ë“œë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤.");
            }
            clickCount = 0;
        }
    }

    function downloadImage() {
        window.scrollTo(0,0);
        html2canvas(document.getElementById('printArea'), { scale: 2 }).then(canvas => {
            const link = document.createElement('a');
            link.download = 'í¸ë°±ë‚˜ë¬´_ì£¼ì°¨ë°°ì •í‘œ.png';
            link.href = canvas.toDataURL();
            link.click();
        });
    }

    init();
</script>
</body>
</html>
