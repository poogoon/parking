<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>í¸ë°±ë‚˜ë¬´ ì£¼ì°¨ ë°°ì • ì‹œìŠ¤í…œ (ë™ê¸°í™” ë²„ì „)</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        /* ê¸°ì¡´ ë””ìì¸ ìŠ¤íƒ€ì¼ ìœ ì§€ */
        body { font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif; text-align: center; background-color: #f4f7f9; margin: 0; padding: 15px; color: #333; }
        .container { max-width: 1200px; margin: auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        h1 { color: #2c3e50; margin-bottom: 8px; font-size: 1.5rem; letter-spacing: -0.5px; }
        .desc { font-size: 13px; color: #7f8c8d; margin-bottom: 25px; }
        .dong-wrapper { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-bottom: 25px; text-align: left; }
        .dong-column { flex: 1; min-width: 280px; background: #fff; padding: 15px; border-radius: 10px; border: 1px solid #dcdde1; box-sizing: border-box; }
        .dong-title { font-weight: bold; border-bottom: 2px solid #34495e; padding-bottom: 10px; margin-bottom: 15px; text-align: center; color: #2c3e50; font-size: 15px; }
        .list-item { display: flex; align-items: center; margin-bottom: 9px; font-size: 14px; padding: 4px 8px; border-radius: 4px; transition: background 0.2s; }
        .list-item:hover { background: #f1f2f6; }
        .list-item input { margin-right: 10px; width: 17px; height: 17px; cursor: pointer; }
        .list-item label { cursor: pointer; width: 100%; }
        .config-area { background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 25px; border: 1px solid #edeff1; }
        .input-group { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; font-weight: bold; font-size: 14px; color: #444; }
        .input-item { background: white; padding: 8px 15px; border-radius: 6px; border: 1px solid #ced4da; display: flex; align-items: center; gap: 8px; }
        input[type="number"] { width: 45px; text-align: center; border: 1px solid #ddd; padding: 4px; border-radius: 4px; font-weight: bold; outline: none; }
        button { border: none; padding: 16px; font-size: 16px; border-radius: 8px; cursor: pointer; width: 100%; font-weight: bold; margin-top: 15px; color: white; transition: background 0.3s; }
        .btn-draw { background-color: #34495e; box-shadow: 0 4px 6px rgba(52, 73, 94, 0.2); }
        .btn-draw:hover { background-color: #2c3e50; }
        .btn-print { background-color: #27ae60; display: none; width: 48%; display: inline-block; } 
        .btn-save { background-color: #e67e22; display: none; width: 48%; display: inline-block; }
        #loadingOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.98); z-index: 1000; flex-direction: column; justify-content: center; align-items: center; }
        .process-bar { width: 200px; height: 4px; background: #eee; border-radius: 2px; position: relative; overflow: hidden; margin-bottom: 20px; }
        .process-progress { width: 0%; height: 100%; background: #34495e; position: absolute; }
        .loading-text { font-size: 1.1rem; font-weight: bold; color: #2c3e50; }
        #resultArea { display: none; margin-top: 35px; border: 2px solid #2c3e50; padding: 30px; border-radius: 8px; background-color: white; }
        .result-header { font-size: 22px; font-weight: bold; border-bottom: 2px solid #2c3e50; padding-bottom: 15px; margin-bottom: 25px; display: flex; justify-content: space-between; align-items: flex-end; }
        .result-date { font-size: 14px; font-weight: normal; color: #7f8c8d; }
        .map-container { display: flex; flex-direction: column; gap: 25px; align-items: center; }
        .building-section { width: 100%; border: 1.5px solid #2c3e50; border-radius: 8px; padding: 25px 15px; position: relative; background: #fff; box-sizing: border-box; }
        .building-label { position: absolute; top: -13px; left: 20px; background: #2c3e50; color: white; padding: 3px 15px; font-size: 12px; border-radius: 4px; font-weight: bold; }
        .parking-row { display: flex; justify-content: center; gap: 6px; margin: 6px 0; align-items: center; flex-wrap: nowrap; }
        .driveway-text { font-size: 11px; color: #bdc3c7; margin: 12px 0; letter-spacing: 12px; font-weight: bold; text-align: center; width: 100%; }
        .between-section { width: 100%; background-color: #f9fbfd; border-radius: 8px; padding: 18px; display: flex; justify-content: center; align-items: center; position: relative; box-sizing: border-box; border: 1px dashed #3498db; }
        .between-label { position: absolute; left: 12px; font-size: 12px; font-weight: bold; color: #3498db; writing-mode: vertical-rl; text-orientation: upright; letter-spacing: 2px; }
        .between-content { display: flex; gap: 50px; justify-content: center; align-items: center; }
        .between-column { display: flex; flex-direction: column; gap: 10px; align-items: center; }
        .col-header { font-size: 11px; font-weight: bold; padding: 2px 10px; border-radius: 3px; background: #3498db; color: white; margin-bottom: 4px; }
        .slot { width: 65px; height: 85px; border-radius: 4px; display: flex; flex-direction: column; justify-content: center; align-items: center; font-size: 11px; text-align: center; position: relative; border: 1px solid #dcdde1; overflow: hidden; }
        .slot strong { display: block; font-size: 13px; width: 100%; line-height: 1.3; color: #2c3e50; }
        .type-disabled { background-color: #edf2ff; border: 2px solid #3f51b5; color: #3f51b5; font-weight: bold; }
        .type-disabled .icon-disabled { font-size: 29px; margin-bottom: 2px; display: block; }
        .type-spot.filled { background-color: #f1f9ff; border-color: #3498db; font-weight: bold; }
        .type-pillar { background-color: #95a5a6; color: white; width: 30px; height: 85px; font-size: 10px; border: none; writing-mode: vertical-lr; letter-spacing: 2px; }
        .type-entrance { background-color: #ecf0f1; border: 2px solid #bdc3c7; color: #7f8c8d; font-weight: bold; width: 80px; font-size: 13px; }
        .type-unassigned { background-color: #fdfdfd; border: 1.5px dashed #bdbdbd; color: #9e9e9e; font-weight: bold; }
        .unassigned-label { color: #e74c3c !important; font-weight: bold; }
        .footer { margin-top: 60px; text-align: center; font-weight: bold; font-size: 16px; color: #2c3e50; border-top: 1px solid #eee; padding-top: 30px; }
        @media print { .no-print { display: none !important; } }
    </style>
</head>
<body>

<div id="loadingOverlay">
    <div class="process-bar"><div id="progressBar" class="process-progress"></div></div>
    <div class="loading-text" id="loadingStatus">ê³µì • ë°°ì • ì—”ì§„ ê°€ë™ ì¤‘...</div>
</div>

<div class="container">
    <h1 class="no-print">í¸ë°±ë‚˜ë¬´ ì£¼ì°¨ êµ¬ì—­ ë°°ì • ì‹œìŠ¤í…œ</h1>
    <p class="desc no-print">ì˜¤ëŠ˜ ë‚ ì§œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë™ê¸°í™”ë˜ì–´ ëª¨ë“  ì…ì£¼ë¯¼ì´ ë™ì¼í•œ ê²°ê³¼ë¥¼ ë³´ê²Œ ë©ë‹ˆë‹¤.</p>

    <div class="dong-wrapper no-print">
        <div id="column-A" class="dong-column"><div class="dong-title">Aë™ (ëŒ€ìƒ ì„¸ëŒ€)</div></div>
        <div id="column-B" class="dong-column"><div class="dong-title">Bë™ (ëŒ€ìƒ ì„¸ëŒ€)</div></div>
        <div id="column-C" class="dong-column"><div class="dong-title">Cë™ (ëŒ€ìƒ ì„¸ëŒ€)</div></div>
    </div>

    <div class="config-area no-print">
        <div class="input-group">
            <div class="input-item"><span>Aë™ ë°°ì •ìˆ˜</span><input type="number" id="limitA" value="9"></div>
            <div class="input-item"><span>Bë™ ë°°ì •ìˆ˜</span><input type="number" id="limitB" value="10"></div>
            <div class="input-item"><span>Cë™ ë°°ì •ìˆ˜</span><input type="number" id="limitC" value="9"></div>
        </div>
        <button class="btn-draw" onclick="startOfficialDraw()">ì£¼ì°¨ êµ¬ì—­ ë°°ì • ì¶”ì²¨ ì‹œì‘</button>
    </div>

    <div id="resultArea">
        <div class="result-header">
            <span>ì£¼ì°¨ êµ¬ì—­ ë°°ì • ê²°ê³¼ ë³´ê³ ì„œ</span>
            <span class="result-date" id="printDate"></span>
        </div>
        <div class="map-container" id="mapContainer"></div>
        <div class="footer">
            <p>ë³¸ ê²°ê³¼ëŠ” ê¸ˆì¼ ë‚ ì§œë¥¼ ì‹œë“œë¡œ í•œ ìë™ ì¶”ì²¨ ì‹œìŠ¤í…œì„ í†µí•´ ê³µì •í•˜ê²Œ ê²°ì •ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
            <br><p>í¸ë°±ë‚˜ë¬´ íƒ€ìš´í•˜ìš°ìŠ¤ ì…ì£¼ë¯¼ ëŒ€í‘œ (ì¸)</p>
        </div>
    </div>

    <div class="no-print" style="margin-top:25px; display:flex; gap:12px; justify-content:center;">
        <button id="printBtn" class="btn-print" onclick="window.print()">ê²°ê³¼ ë¬¸ì„œ ì¶œë ¥</button>
        <button id="saveBtn" class="btn-save" onclick="saveAsImage()">ê²°ê³¼ ì´ë¯¸ì§€ ì €ì¥</button>
    </div>
</div>

<script>
    // ğŸ² ì‹œë“œ ê¸°ë°˜ ë¬´ì‘ìœ„ ìˆ«ì ìƒì„±ê¸° (ë™ê¸°í™”ì˜ í•µì‹¬)
    function seededRandom(seed) {
        return function() {
            seed = (seed * 9301 + 49297) % 233280;
            return seed / 233280;
        };
    }

    function generateList() {
        const columns = { 'A': document.getElementById('column-A'), 'B': document.getElementById('column-B'), 'C': document.getElementById('column-C') };
        const unchecked = ['Aë™ 201í˜¸', 'Aë™ 202í˜¸', 'Aë™ 401í˜¸', 'Cë™ 202í˜¸', 'Cë™ 502í˜¸'];
        const add = (col, full, label, val) => {
            const isChecked = unchecked.includes(full) ? '' : 'checked';
            const div = document.createElement('div');
            div.className = 'list-item';
            div.innerHTML = `<label><input type="checkbox" ${isChecked} value="${val}">${label}</label>`;
            col.appendChild(div);
        };
        for(let f=2; f<=5; f++) for(let r=1; r<=3; r++) add(columns['A'], `Aë™ ${f}0${r}í˜¸`, `${f}0${r}í˜¸`, `A-${f}0${r}í˜¸`);
        for(let f=2; f<=5; f++) for(let r=1; r<=(f<=3?3:2); r++) add(columns['B'], `Bë™ ${f}0${r}í˜¸`, `${f}0${r}í˜¸`, `B-${f}0${r}í˜¸`);
        for(let f=2; f<=5; f++) for(let r=1; r<=(f<=4?3:2); r++) add(columns['C'], `Cë™ ${f}0${r}í˜¸`, `${f}0${r}í˜¸`, `C-${f}0${r}í˜¸`);
    }
    generateList();

    function startOfficialDraw() {
        const getChecked = (dong) => Array.from(document.querySelectorAll(`#column-${dong} input:checked`)).map(e => e.value);
        const candidates = { 'A': getChecked('A'), 'B': getChecked('B'), 'C': getChecked('C') };
        if (candidates.A.length + candidates.B.length + candidates.C.length === 0) return alert("ëŒ€ìƒ ì„¸ëŒ€ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.");

        const overlay = document.getElementById('loadingOverlay');
        const progressBar = document.getElementById('progressBar');
        overlay.style.display = 'flex';
        
        let p = 0;
        const interval = setInterval(() => {
            p += 5;
            progressBar.style.width = p + "%";
            if(p >= 100) {
                clearInterval(interval);
                overlay.style.display = 'none';
                showOfficialResult(candidates);
            }
        }, 50);
    }

    function showOfficialResult(candidates) {
        const now = new Date();
        // ğŸ—“ï¸ ì˜¤ëŠ˜ ë‚ ì§œ(YYYYMMDD)ë¥¼ ì‹œë“œë¡œ ì‚¬ìš©í•˜ì—¬ ê²°ê³¼ ê³ ì •
        const seedValue = now.getFullYear() * 10000 + (now.getMonth() + 1) * 100 + now.getDate();
        const rng = seededRandom(seedValue);

        const limits = {
            'A': parseInt(document.getElementById('limitA').value) || 0,
            'B': parseInt(document.getElementById('limitB').value) || 0,
            'C': parseInt(document.getElementById('limitC').value) || 0
        };

        const winners = {};
        ['A', 'B', 'C'].forEach(d => {
            // ì‹œë“œ ê¸°ë°˜ ì…”í”Œ
            winners[d] = candidates[d]
                .map(value => ({ value, sort: rng() }))
                .sort((a, b) => a.sort - b.sort)
                .map(({ value }) => value)
                .slice(0, limits[d]);
        });

        document.getElementById('printDate').innerText = `ë°°ì • ê¸°ì¤€ì¼: ${now.toLocaleDateString()}`;
        document.getElementById('resultArea').style.display = 'block';
        document.getElementById('printBtn').style.display = 'inline-block';
        document.getElementById('saveBtn').style.display = 'inline-block';

        renderOfficialMap(winners);
        window.scrollTo({ top: document.getElementById('resultArea').offsetTop - 20, behavior: 'smooth' });
    }

    function renderOfficialMap(winners) {
        const container = document.getElementById('mapContainer');
        container.innerHTML = '';
        const hasC403 = winners.C.includes('C-403í˜¸');
        const qA = [...winners.A]; const qB = [...winners.B]; 
        const qC = winners.C.filter(name => name !== 'C-403í˜¸');

        const createSlot = (type, queue, dongName = '') => {
            let content = '';
            let className = `slot type-${type === 'S' ? 'spot' : type === 'P' ? 'pillar' : type === 'E' ? 'entrance' : type === 'D' ? 'disabled' : type === 'U' ? 'unassigned' : 'space'}`;
            if (type === 'S') {
                const w = queue && queue.length > 0 ? queue.shift() : '';
                if (w) { content = `<strong>${w.replace('-', '<br>')}</strong>`; className += ' filled'; }
                else content = `<span class="unassigned-label">ë¯¸ë°°ì •</span>`; 
            } else if (type === 'D') {
                if (dongName === 'C' && hasC403) { content = '<span class="icon-disabled">â™¿</span><strong>C<br>403í˜¸</strong>'; className += ' filled'; }
                else content = '<span class="icon-disabled">â™¿</span>ë¹„ì§€ì •';
            } else if (type === 'U') content = 'ë¹„ì§€ì •';
            else if (type === 'P') content = 'ê¸°ë‘¥';
            else if (type === 'E') content = 'ì¶œì…ë¬¸';
            return `<div class="${className}">${content}</div>`;
        };
        
        const row = (layout, queue, dongName = '') => `<div class="parking-row">${layout.map(t => createSlot(t, queue, dongName)).join('')}</div>`;

        container.innerHTML = `
            <div class="building-section"><div class="building-label">Aë™ í•„ë¡œí‹°</div>
                ${row(['D', 'P', 'U', 'P', 'S', 'S'], qA)}<div class="driveway-text">ë°°ì°¨ í†µë¡œ</div>
                ${row(['S', 'P', 'S', 'E', 'U', 'P', 'S', 'S'], qA)}</div>
            <div class="between-section"><div class="between-label">A-B ì‚¬ì´</div><div class="between-content">
                <div class="between-column"><div class="col-header">Aë™ êµ¬ì—­</div>${createSlot('S', qA)}${createSlot('S', qA)}</div>
                <div class="between-column"><div class="col-header">Aë™ êµ¬ì—­</div>${createSlot('S', qA)}${createSlot('D', null)}</div></div></div>
            <div class="building-section"><div class="building-label">Bë™ í•„ë¡œí‹°</div>
                ${row(['S', 'S', 'P', 'U', 'P', 'S', 'S'], qB)}<div class="driveway-text">ë°°ì°¨ í†µë¡œ</div>
                ${row(['S', 'S', 'E', 'U', 'S'], qB)}</div>
            <div class="between-section"><div class="between-label">B-C ì‚¬ì´</div><div class="between-content">
                <div class="between-column"><div class="col-header">Bë™ êµ¬ì—­</div>${createSlot('S', qB)}${createSlot('S', qB)}</div>
                <div class="between-column"><div class="col-header">Cë™ êµ¬ì—­</div>${createSlot('S', qB)}${createSlot('S', qC)}</div></div></div>
            <div class="building-section"><div class="building-label">Cë™ í•„ë¡œí‹°</div>
                ${row(['S', 'S', 'P', 'S', 'D', 'P', '_'], qC, 'C')}<div class="driveway-text">ë°°ì°¨ í†µë¡œ</div>
                ${row(['S', 'S', 'E', 'S', 'S'], qC)}</div>`;
    }

    function saveAsImage() {
        const area = document.getElementById('resultArea');
        html2canvas(area, { scale: 2 }).then(canvas => {
            const link = document.createElement('a');
            link.download = `í¸ë°±ë‚˜ë¬´_ì£¼ì°¨ë°°ì •_ìµœì¢…ê²°ê³¼.png`;
            link.href = canvas.toDataURL();
            link.click();
        });
    }
</script>
</body>
</html>
