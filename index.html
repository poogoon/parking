<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>í¸ë°±ë‚˜ë¬´ ì£¼ì°¨ ë°°ì • (ë™ë³„ ì¶”ì²¨)</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        body { font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif; text-align: center; background-color: #f0f2f5; margin: 0; padding: 10px; color: #333; -webkit-text-size-adjust: none; }
        .container { max-width: 100%; margin: auto; background: white; padding: 15px 10px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); box-sizing: border-box; }
        h1 { font-size: 1.4rem; margin-bottom: 5px; color: #1a73e8; word-break: keep-all; }
        .desc { font-size: 12px; color: #666; margin-bottom: 15px; word-break: keep-all; }

        .dong-wrapper { display: flex; justify-content: center; gap: 5px; margin-bottom: 20px; text-align: left; width: 100%; }
        .dong-column { flex: 1; background: #f8f9fa; padding: 8px 4px; border-radius: 10px; border: 1px solid #e1e4e8; min-width: 0; }
        .dong-title { font-weight: bold; border-bottom: 2px solid #1a73e8; padding-bottom: 4px; margin-bottom: 8px; text-align: center; color: #1a73e8; font-size: 13px; }
        
        .list-item { display: flex; align-items: center; margin-bottom: 6px; font-size: 12px; white-space: nowrap; overflow: hidden; }
        .list-item input { margin-right: 3px; width: 14px; height: 14px; flex-shrink: 0; }
        .list-item label { display: flex; align-items: center; width: 100%; cursor: pointer; overflow: hidden; }

        .config-area { background: #e8f0fe; padding: 12px; border-radius: 12px; margin-bottom: 15px; }
        .input-group { display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 10px; font-weight: bold; font-size: 13px; }
        .input-item { display: flex; align-items: center; gap: 3px; background: white; padding: 5px 10px; border-radius: 8px; border: 1px solid #d0d7de; }
        input[type="number"] { width: 35px; padding: 5px; border-radius: 5px; border: 1px solid #ccc; text-align: center; font-size: 14px; }
        
        button { border: none; padding: 12px; font-size: 15px; border-radius: 10px; cursor: pointer; width: 100%; font-weight: bold; margin-top: 8px; transition: 0.3s; }
        .btn-draw { background-color: #1a73e8; color: white; margin-top: 15px; }
        .btn-print { background-color: #4CAF50; color: white; margin-top: 10px; display: none; } 
        .btn-save { background-color: #FF5722; color: white; margin-top: 10px; display: none; }

        #resultArea { margin-top: 20px; padding: 15px; background: #ffffff; border: 2px solid #1a73e8; border-radius: 15px; display: none; text-align: left; }
        .result-header { font-size: 18px; font-weight: bold; color: #1a73e8; margin-bottom: 5px; text-align: center; border-bottom: 1px solid #ddd; padding-bottom: 10px; }
        .result-date { font-size: 12px; color: #666; text-align: right; margin-bottom: 5px; font-weight: normal; }
        .edit-hint { font-size: 12px; color: #e91e63; text-align: center; margin-bottom: 10px; font-weight: bold; }
        
        /* ê²°ê³¼ ê·¸ë¦¬ë“œ ìŠ¤íƒ€ì¼ */
        .result-section-title { grid-column: 1 / -1; background-color: #eee; padding: 5px; text-align: center; font-weight: bold; font-size: 14px; margin-top: 10px; border-radius: 5px; color: #333; }
        .result-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .result-slot { padding: 8px; background: #f1f8e9; border-radius: 5px; font-size: 13px; border: 1px solid #c8e6c9; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: flex; justify-content: space-between; }
        .editable-name { border-bottom: 1px dashed #999; cursor: text; padding: 0 2px; color: #000; font-weight: normal; }
        
        .print-footer { display: none; margin-top: 50px; text-align: center; font-size: 14px; font-weight: bold; }

        #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.95); z-index: 1000; flex-direction: column; justify-content: center; align-items: center; }
        .lotto-ball { width: 80px; height: 80px; background: radial-gradient(circle at 30% 30%, #ffd700, #ff8c00); border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 24px; animation: bounce 0.5s infinite alternate; }
        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-20px); } }

        /* ğŸ–¨ï¸ ì¸ì‡„ ë° ì´ë¯¸ì§€ ì €ì¥ ì‹œ ì ìš©ë  ìŠ¤íƒ€ì¼ */
        @media print {
            body { background-color: white; padding: 0; -webkit-print-color-adjust: exact; }
            .container { box-shadow: none; border: none; padding: 0; width: 100%; max-width: 100%; }
            .no-print { display: none !important; }
            #resultArea { display: block !important; border: 2px solid #333; margin: 0; padding: 20px; page-break-inside: avoid; }
            .result-header { color: #000; font-size: 24px; border-bottom: 2px solid #333; }
            .edit-hint { display: none; }
            .result-slot { border: 1px solid #333; background-color: #fff; color: #000; font-size: 14px; }
            .result-section-title { background-color: #ddd !important; border: 1px solid #333; color: #000; }
            .editable-name { border-bottom: none; }
            .print-footer { display: block; }
            h1 { display: none; }
        }

        /* ğŸ–¼ï¸ ì´ë¯¸ì§€ ìº¡ì²˜ ëª¨ë“œìš© ê°•ì œ ìŠ¤íƒ€ì¼ */
        .capturing-mode .edit-hint { display: none !important; }
        .capturing-mode .print-footer { display: block !important; }
        .capturing-mode .editable-name { border-bottom: none !important; }
        .capturing-mode { border: 2px solid #333 !important; padding: 20px !important; background-color: white; }
        .capturing-mode .result-header { border-bottom: 2px solid #333 !important; color: #000 !important; }
        .capturing-mode .result-slot { border: 1px solid #333 !important; color: #000 !important; }
        .capturing-mode .result-section-title { background-color: #ddd !important; border: 1px solid #333 !important; color: #000 !important; }
    </style>
</head>
<body>

<div class="container">
    <h1 class="no-print">ğŸš— í¸ë°±ë‚˜ë¬´ ì£¼ì°¨ ë°°ì • (ë™ë³„)</h1>
    <p class="desc no-print">ê° ë™ë³„ë¡œ ì²´í¬ëœ ì„¸ëŒ€ë¼ë¦¬ë§Œ ì¶”ì²¨í•©ë‹ˆë‹¤.</p>

    <div class="dong-wrapper no-print">
        <div class="dong-column" id="column-A"><div class="dong-title">Aë™</div></div>
        <div class="dong-column" id="column-B"><div class="dong-title">Bë™</div></div>
        <div class="dong-column" id="column-C"><div class="dong-title">Cë™</div></div>
    </div>

    <div class="config-area no-print">
        <div class="input-group">
            <div class="input-item"><span>Aë™</span> <input type="number" id="limitA" value="8"><span>ëŒ€</span></div>
            <div class="input-item"><span>Bë™</span> <input type="number" id="limitB" value="10"><span>ëŒ€</span></div>
            <div class="input-item"><span>Cë™</span> <input type="number" id="limitC" value="9"><span>ëŒ€</span></div>
        </div>
        <button class="btn-draw" onclick="startDraw()">ë™ë³„ ë°°ì • ì¶”ì²¨ ì‹œì‘!</button>
    </div>

    <div id="resultArea">
        <div class="result-header">
            ì£¼ì°¨ êµ¬ì—­ ë°°ì • ê²°ê³¼
            <div class="result-date" id="printDate"></div>
        </div>
        <div class="edit-hint no-print">ğŸ’¡ Tip: í˜¸ìˆ˜ë¥¼ í´ë¦­í•˜ë©´ ë‚´ìš©ì„ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
        
        <div id="winnerList" class="result-grid"></div>

        <div class="print-footer">
            <p>ìœ„ì™€ ê°™ì´ ì£¼ì°¨ êµ¬ì—­ ë°°ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.</p>
            <br><br>
            <p>2026ë…„ &nbsp;&nbsp; ì›” &nbsp;&nbsp; ì¼</p>
            <br>
            <p style="font-size: 16px;">í¸ë°±ë‚˜ë¬´ íƒ€ìš´í•˜ìš°ìŠ¤ ì…ì£¼ë¯¼ ëŒ€í‘œ (ì¸)</p>
        </div>
    </div>

    <button id="printBtn" class="btn-print no-print" onclick="window.print()">ğŸ–¨ï¸ ê²°ê³¼ ì¶œë ¥í•˜ê¸° (A4)</button>
    <button id="saveBtn" class="btn-save no-print" onclick="saveAsImage()">ğŸ–¼ï¸ ê²°ê³¼ ì´ë¯¸ì§€ ì €ì¥ (í°/PC)</button>
</div>

<div id="overlay">
    <div class="lotto-ball">ğŸ±</div>
    <div style="margin-top:20px; font-weight:bold; color:#1a73e8;">ë™ë³„ ê³µì • ì¶”ì²¨ ì§„í–‰ ì¤‘...</div>
</div>

<script>
    // ğŸ›‘ ê¸°ë³¸ì ìœ¼ë¡œ ì²´í¬ í•´ì œí•  ëª…ë‹¨ (Aë™ 301í˜¸ ì œê±°ë¨ -> ë‹¤ì‹œ ì²´í¬ ìƒíƒœ)
    const uncheckedList = [
        'Aë™ B01í˜¸', 'Aë™ 201í˜¸', 'Aë™ 202í˜¸', 'Aë™ 401í˜¸',
        'Bë™ B01í˜¸',
        'Cë™ 202í˜¸', 'Cë™ 502í˜¸'
    ];

    function generateList() {
        const columns = { 'A': document.getElementById('column-A'), 'B': document.getElementById('column-B'), 'C': document.getElementById('column-C') };

        // Aë™
        addSet(columns['A'], `Aë™ B01í˜¸`, `B01í˜¸`);
        for (let floor = 2; floor <= 5; floor++) {
            for (let room = 1; room <= 3; room++) { addSet(columns['A'], `Aë™ ${floor}0${room}í˜¸`, `${floor}0${room}í˜¸`); }
        }

        // Bë™
        addSet(columns['B'], `Bë™ B01í˜¸`, `B01í˜¸`); 
        for (let floor = 2; floor <= 5; floor++) {
            let maxRoom = (floor <= 3) ? 3 : 2;
            for (let room = 1; room <= maxRoom; room++) { addSet(columns['B'], `Bë™ ${floor}0${room}í˜¸`, `${floor}0${room}í˜¸`); }
        }

        // Cë™
        for (let floor = 2; floor <= 5; floor++) {
            let maxRoom = (floor <= 4) ? 3 : 2;
            for (let room = 1; room <= maxRoom; room++) { addSet(columns['C'], `Cë™ ${floor}0${room}í˜¸`, `${floor}0${room}í˜¸`); }
        }
    }

    function addSet(column, fullName, displayName) {
        // uncheckedListì— í¬í•¨ë˜ì–´ ìˆìœ¼ë©´ ì²´í¬ í•´ì œ ìƒíƒœ('')ë¡œ, ì•„ë‹ˆë©´ ì²´í¬('checked')
        const isChecked = uncheckedList.includes(fullName) ? '' : 'checked';
        
        const div = document.createElement('div');
        div.className = 'list-item';
        div.innerHTML = `<label><input type="checkbox" ${isChecked} value="${fullName}">${displayName}</label>`;
        column.appendChild(div);
    }

    generateList();

    const printDate = document.getElementById('printDate');

    function startDraw() {
        const allChecked = Array.from(document.querySelectorAll('input[type="checkbox"]:checked'));
        if (allChecked.length === 0) return alert("ì¶”ì²¨ ëŒ€ìƒ ì„¸ëŒ€ê°€ ì—†ìŠµë‹ˆë‹¤.");

        const candidates = {
            'A': allChecked.filter(el => el.value.startsWith('Aë™')).map(el => el.value),
            'B': allChecked.filter(el => el.value.startsWith('Bë™')).map(el => el.value),
            'C': allChecked.filter(el => el.value.startsWith('Cë™')).map(el => el.value)
        };

        const limits = {
            'A': parseInt(document.getElementById('limitA').value) || 0,
            'B': parseInt(document.getElementById('limitB').value) || 0,
            'C': parseInt(document.getElementById('limitC').value) || 0
        };
        
        const overlay = document.getElementById('overlay');
        const winnerList = document.getElementById('winnerList');
        const resultArea = document.getElementById('resultArea');
        const printBtn = document.getElementById('printBtn');
        const saveBtn = document.getElementById('saveBtn');
        
        const now = new Date();
        printDate.innerText = `ì¶”ì²¨ì¼: ${now.getFullYear()}.${now.getMonth()+1}.${now.getDate()}`;

        resultArea.style.display = 'none';
        printBtn.style.display = 'none';
        saveBtn.style.display = 'none';
        winnerList.innerHTML = '';
        overlay.style.display = 'flex';

        setTimeout(() => {
            overlay.style.display = 'none';
            
            ['A', 'B', 'C'].forEach(dong => {
                const groupCandidates = candidates[dong];
                const limit = limits[dong];

                if (groupCandidates.length > 0 && limit > 0) {
                    const sectionTitle = document.createElement('div');
                    sectionTitle.className = 'result-section-title';
                    sectionTitle.innerText = `${dong}ë™ ë°°ì • ê²°ê³¼ (ì´ ${Math.min(limit, groupCandidates.length)}ëŒ€)`;
                    winnerList.appendChild(sectionTitle);

                    const shuffled = groupCandidates.sort(() => 0.5 - Math.random());
                    const winners = shuffled.slice(0, limit);

                    winners.forEach((winner, index) => {
                        const slot = document.createElement('div');
                        slot.className = 'result-slot';
                        slot.innerHTML = `<b>${index + 1}ë²ˆ:</b> <span class="editable-name" contenteditable="true">${winner}</span>`;
                        winnerList.appendChild(slot);
                    });
                }
            });

            resultArea.style.display = 'block';
            printBtn.style.display = 'block';
            saveBtn.style.display = 'block';
            window.scrollTo({ top: resultArea.offsetTop - 20, behavior: 'smooth' });
        }, 1500);
    }

    function saveAsImage() {
        const resultArea = document.getElementById('resultArea');
        const saveBtn = document.getElementById('saveBtn');

        saveBtn.innerText = "ì´ë¯¸ì§€ ìƒì„± ì¤‘...";
        saveBtn.disabled = true;

        resultArea.classList.add('capturing-mode');

        setTimeout(() => {
             html2canvas(resultArea, {
                backgroundColor: "#ffffff",
                scale: 2
            }).then(canvas => {
                resultArea.classList.remove('capturing-mode');
                saveBtn.innerText = "ğŸ–¼ï¸ ê²°ê³¼ ì´ë¯¸ì§€ ì €ì¥ (í°/PC)";
                saveBtn.disabled = false;

                const link = document.createElement('a');
                link.download = `ë™ë³„ì£¼ì°¨ì¶”ì²¨ê²°ê³¼_${printDate.innerText.replace('ì¶”ì²¨ì¼: ', '').replace(/\./g,'')}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        }, 300);
    }
</script>
</body>
</html>
